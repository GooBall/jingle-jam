<% content_for :head do %>
  <script src="https://js.stripe.com/v3/"></script>
  <script type="text/javascript">
    onReady(function() {
      Packs.application.addStripeToForm(document.getElementById('donation-form'));
      Packs.application.enableCharitySplit(document.getElementsByClassName('charity-split')[0]);
    })
  </script>
<% end %>

<h2>Make a donation</h2>

<%= form_tag stripe_prep_checkout_path, id: "donation-form", :'data-stripe-public-key' => ENV["STRIPE_PUBLIC_KEY"], :'data-test-mode' => Rails.env.test? do %>
  <p>
    <%= label_tag :currency %>
    <%= select_tag :currency, options_for_select(Currency.present_all, Currency::DEFAULT_CURRENCY.downcase) %>
  </p>

  <p>
    <%= label_tag :amount %>
    <%= text_field_tag :amount, "25.00", class: "amount" %>
  </p>

  <ul class="charity-split" hidden>
    <%= fields_for :charity_split do |fields| %>
      <% Charity.find_each do |charity| %>
        <li>
          <p><%= fields.label "charity_#{charity.id}", charity.name %></p>
          <p>
            <%= fields.range_field "charity_#{charity.id}" %>
            <input type="text" class="manual amount" />
          </p>
        </li>
      <% end %>
    <% end %>
  </ul>

  <p>
    <%= label_tag :message, "Message (optional)" %>
    <%= text_field_tag :message %>
  </p>

  <% if local_assigns.has_key?(:streamer) && streamer.present? %>
    <%= hidden_field_tag :curated_streamer_id, streamer.id %>
  <% end %>

  <button id="stripe-donate">Donate</button>
<% end %>
